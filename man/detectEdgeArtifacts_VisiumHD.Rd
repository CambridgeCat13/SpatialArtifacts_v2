% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/detectEdgeDryspots_VisiumHD.R
\name{detectEdgeArtifacts_VisiumHD}
\alias{detectEdgeArtifacts_VisiumHD}
\title{Detect Edge Artifacts in VisiumHD Data}
\usage{
detectEdgeArtifacts_VisiumHD(
  spe,
  resolution,
  qc_metric = "sum_gene",
  samples = "sample_id",
  mad_threshold = 3,
  buffer_width_um = 80,
  min_cluster_area_um2 = 1280,
  batch_var = "sample_id",
  col_x = "array_col",
  col_y = "array_row",
  name = "edge_artifact",
  verbose = TRUE,
  keep_intermediate = FALSE
)
}
\arguments{
\item{spe}{SpatialExperiment object}

\item{resolution}{Resolution: "8um" or "16um" (REQUIRED)}

\item{qc_metric}{QC metric column (default: "sum_gene")}

\item{samples}{Sample ID column (default: "sample_id")}

\item{mad_threshold}{MAD threshold (default: 3)}

\item{buffer_width_um}{Buffer zone width in micrometers (default: 80)
Approximately 10 bins at 8µm resolution, 5 bins at 16µm resolution}

\item{min_cluster_area_um2}{Minimum cluster area in µm² (default: 1280)
Approximately 20 bins at 8µm resolution, 5 bins at 16µm resolution
Default based on 16µm standard (5 bins = reasonable minimum cluster)}

\item{batch_var}{Batch variable (default: "sample_id")}

\item{col_x}{X coordinate column (default: "array_col")}

\item{col_y}{Y coordinate column (default: "array_row")}

\item{name}{Output column prefix (default: "edge_artifact")}

\item{verbose}{Print progress (default: TRUE)}

\item{keep_intermediate}{Keep intermediate columns (default: FALSE)}
}
\description{
Detect Edge Artifacts in VisiumHD Data
}
\details{
IMPORTANT: This function uses array_col/array_row (bin indices), NOT
pixel coordinates. This is much more memory efficient.

Buffer width and cluster size are specified in physical units (µm, µm²)
and automatically converted to bins based on resolution:
\itemize{
\item 8µm resolution: 1 bin = 8×8 µm = 64 µm²
\item 16µm resolution: 1 bin = 16×16 µm = 256 µm²
}

Default parameters are designed for 16µm resolution:
\itemize{
\item buffer_width_um = 80 µm → 5 bins at 16µm, 10 bins at 8µm
\item min_cluster_area_um2 = 1280 µm² → 5 bins at 16µm, 20 bins at 8µm
}
}
\examples{
library(SpatialExperiment)
library(S4Vectors)

# 1. Runnable Example: Mock Data (Try this!)

# Create a mock Visium HD dataset (20x20 grid, representing 320x320 um)
n_rows <- 20
n_cols <- 20
n_bins <- n_rows * n_cols
coords <- expand.grid(array_row = 1:n_rows, array_col = 1:n_cols)

# Simulate gene counts: Edge artifact (left 2 cols) has low counts
counts <- rep(100, n_bins)
is_edge <- coords$array_col <= 2
counts[is_edge] <- 10 

# Create SpatialExperiment object
spe_hd <- SpatialExperiment(
    assays = list(counts = matrix(counts, nrow = 1, ncol = n_bins)),
    colData = DataFrame(
        sample_id = "mock_hd",
        in_tissue = rep(TRUE, n_bins),
        sum_gene = counts, 
        array_row = coords$array_row,
        array_col = coords$array_col
    )
)

# Run detection for 16um resolution
# (Physical buffer 80um / 16um bin size = 5 bins. Artifact is 2 bins wide.)
spe_hd <- detectEdgeArtifacts_VisiumHD(
    spe_hd, 
    resolution = "16um",
    qc_metric = "sum_gene"
)

# Check results
table(spe_hd$edge_artifact_edge)

# 2. Illustrative Examples (Concept only)
\dontrun{
# Assuming 'spe' is a real SpatialExperiment object

# 8µm data with defaults
# buffer_width_um = 80 -> 10 bins (80 / 8)
# min_cluster_area_um2 = 1280 -> 20 bins
spe <- detectEdgeArtifacts_VisiumHD(spe, resolution = "8um")

# 16µm data with defaults  
# buffer_width_um = 80 -> 5 bins (80 / 16)
# min_cluster_area_um2 = 1280 -> 5 bins
spe <- detectEdgeArtifacts_VisiumHD(spe, resolution = "16um")

# Custom parameters (physical units)
spe <- detectEdgeArtifacts_VisiumHD(
  spe, 
  resolution = "16um",
  buffer_width_um = 100,      # 100 µm buffer
  min_cluster_area_um2 = 2000 # 2000 µm² minimum 
)
}

}
