<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Spatial Edge Artifacts Detection in Hippocampus Data • SpatialDryArtifacts</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Spatial Edge Artifacts Detection in Hippocampus Data">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">SpatialDryArtifacts</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.99.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/hippocampus-edge-detection.html">Spatial Edge Artifacts Detection in Hippocampus Data</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/CambridgeCat13/SpatialDryArtifacts/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Spatial Edge Artifacts Detection in Hippocampus
Data</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/CambridgeCat13/SpatialDryArtifacts/blob/HEAD/vignettes/hippocampus-edge-detection.Rmd" class="external-link"><code>vignettes/hippocampus-edge-detection.Rmd</code></a></small>
      <div class="hidden name"><code>hippocampus-edge-detection.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The <strong>SpatialDryArtifacts</strong> R package provides a robust,
two-step workflow to identify, classify, and handle spatial artifacts in
spatial transcriptomics data from multiple platforms including
<strong>10x Visium</strong> (standard and HD).</p>
<p>These artifacts, often appearing as areas of low gene/UMI counts or
high mitochondrial ratio at tissue edges (edge artifacts) or in the
interior (interior artifacts), can negatively impact downstream
analyses. This guide demonstrates how to use the package on real-world
datasets across different spatial transcriptomics platforms.</p>
<div class="section level3">
<h3 id="platform-support">Platform Support<a class="anchor" aria-label="anchor" href="#platform-support"></a>
</h3>
<p><strong>SpatialDryArtifacts</strong> is designed to work across
multiple spatial transcriptomics platforms:</p>
<ul>
<li>
<strong>Standard Visium</strong> (55µm bins, hexagonal grid): ~5,000
spots per capture area</li>
<li>
<strong>VisiumHD 16µm</strong> (16µm bins, square grid): ~480,000
bins per capture area<br>
</li>
<li>
<strong>VisiumHD 8µm</strong> (8µm bins, square grid): ~1,920,000
bins per capture area</li>
</ul>
<p>The morphological detection framework automatically adapts to
different grid arrangements, but <strong>parameter scaling is
critical</strong> for optimal performance across platforms.</p>
</div>
<div class="section level3">
<h3 id="the-spatialdryartifacts-workflow">The SpatialDryArtifacts Workflow<a class="anchor" aria-label="anchor" href="#the-spatialdryartifacts-workflow"></a>
</h3>
<p>The core philosophy is a two-step process: <strong>Detect, then
Classify</strong>.<br>
This separates the sensitive task of identifying all potential problem
spots from the more nuanced task of deciding what to do with them.</p>
<div class="section level4">
<h4 id="step-1-detectedgeartifacts-the-detection-phase">
<strong>Step 1: <code>detectEdgeArtifacts()</code> — The Detection
Phase</strong><a class="anchor" aria-label="anchor" href="#step-1-detectedgeartifacts-the-detection-phase"></a>
</h4>
<p><strong>Goal</strong>: Cast a wide net and identify all spots that
could potentially be part of an artifact.</p>
<p><strong>How does it work</strong>:</p>
<ul>
<li>
<strong>Outlier Identification</strong>: Finds spots with abnormally
low QC metrics (e.g., <code>sum_gene</code>) using a Median Absolute
Deviation (MAD) threshold.<br>
</li>
<li>
<strong>Morphological Cleaning</strong>: Applies sequential
raster-based focal operations through
<code>focal_transformations()</code>:
<ol style="list-style-type: decimal">
<li>
<strong>3×3 fill</strong> (<code>my_fill</code>): Fills spots
completely surrounded by outliers</li>
<li>
<strong>5×5 outline</strong> (<code>my_outline</code>): Fills spots
outlined by outliers in a larger 16-pixel perimeter</li>
<li>
<strong>Star pattern</strong> (<code>my_fill_star</code>): Fills
spots with outliers in all four cardinal directions (N, S, E, W)</li>
<li>
<strong>Small cluster removal</strong>: Removes isolated normal
regions below <code>min_cluster_size</code> threshold (default: 40
spots)</li>
</ol>
<ul>
<li>Uses 8-directional connectivity for connected component
analysis</li>
</ul>
</li>
<li>
<strong>Cluster Detection</strong>: Groups these outliers into
contiguous “problem areas” (<code>problemAreas</code>).<br>
</li>
<li>
<strong>Edge Identification</strong>: Evaluates whether clusters
touch tissue boundaries using <code><a href="../reference/clumpEdges.html">clumpEdges()</a></code>. For each of the
four borders (north, south, east, west), calculates the proportion of
boundary spots belonging to each cluster. A cluster is classified as an
edge artifact if this proportion meets or exceeds
<code>edge_threshold</code> (default: 0.75, meaning ≥75% border
coverage) on any single border direction.</li>
<li>
<strong>Key Outputs</strong>: Adds three <em>raw</em> columns to
your <code>spe</code> object: <code>_edge</code>,
<code>_problem_id</code>, and <code>_problem_size</code>.</li>
</ul>
</div>
<div class="section level4">
<h4 id="step-2-classifyedgeartifacts-the-decision-phase">
<strong>Step 2: <code>classifyEdgeArtifacts()</code> — The Decision
Phase</strong><a class="anchor" aria-label="anchor" href="#step-2-classifyedgeartifacts-the-decision-phase"></a>
</h4>
<p><strong>Goal</strong>: Take the raw detections from Step 1 and apply
a clear, hierarchical logic to assign final labels.</p>
<p><strong>How does it work</strong>: - <strong>Input</strong>: Requires
the <code>spe</code> object processed by
<code><a href="../reference/detectEdgeArtifacts.html">detectEdgeArtifacts()</a></code>.<br>
- <strong>Hierarchical Classification</strong>: Applies a 2×2 logic
system based on <strong>Location</strong> and <strong>Size</strong>: 1.
<strong>Location</strong>: Is the artifact an
<code>_edge_artifact</code> (<code>TRUE</code> or <code>FALSE</code>)
based on the detection step?<br>
2. <strong>Size</strong>: Is the artifact’s <code>_problem_size</code>
larger than <code>min_spots</code> (default: <code>20</code>)?<br>
- <strong>Label Assignment</strong>: This logic produces five intuitive
categories: - <code>"not_artifact"</code> — High-quality spots<br>
- <code>"large_edge_artifact"</code> — Large artifact cluster
(<code>&gt; min_spots</code>) touching the tissue edge<br>
- <code>"small_edge_artifact"</code> — Small artifact cluster
(<code>≤ min_spots</code>) touching the tissue edge<br>
- <code>"large_interior_artifact"</code> — Large artifact cluster
(<code>&gt; min_spots</code>) located inside the tissue<br>
- <code>"small_interior_artifact"</code> — Small artifact cluster
(<code>≤ min_spots</code>) located inside the tissue<br>
- <strong>Key Outputs</strong>: Adds one final, intuitive classification
column: <code>_classification</code>.</p>
</div>
</div>
<div class="section level3">
<h3 id="parameter-guide">Parameter Guide<a class="anchor" aria-label="anchor" href="#parameter-guide"></a>
</h3>
<p>Tuning parameters lets you adapt the workflow to different tissue
types, data quality, <strong>and spatial transcriptomics
platforms</strong>. The package uses a <strong>wrapper function</strong>
that routes to platform-specific implementations.</p>
<div class="section level4">
<h4 id="platform-selection">
<strong>Platform Selection</strong><a class="anchor" aria-label="anchor" href="#platform-selection"></a>
</h4>
<p><strong>CRITICAL FIRST STEP:</strong> Specify your platform using the
<code>platform</code> parameter in
<code><a href="../reference/detectEdgeArtifacts.html">detectEdgeArtifacts()</a></code>:</p>
<table class="table">
<colgroup>
<col width="22%">
<col width="31%">
<col width="46%">
</colgroup>
<thead><tr class="header">
<th>Platform</th>
<th>Function Call</th>
<th>Required Parameters</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><strong>Standard Visium</strong></td>
<td><code>detectEdgeArtifacts(spe, platform="visium", ...)</code></td>
<td>
<code>shifted</code> (usually <code>TRUE</code>)</td>
</tr>
<tr class="even">
<td><strong>VisiumHD</strong></td>
<td><code>detectEdgeArtifacts(spe, platform="visiumhd", resolution="16um", ...)</code></td>
<td>
<code>resolution</code> (“8um” or “16um”)</td>
</tr>
</tbody>
</table>
<p><strong>Example calls:</strong></p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Standard Visium (55µm hexagonal grid)</span></span>
<span><span class="va">spe</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/detectEdgeArtifacts.html">detectEdgeArtifacts</a></span><span class="op">(</span><span class="va">spe</span>, platform <span class="op">=</span> <span class="st">"visium"</span>, shifted <span class="op">=</span> <span class="cn">TRUE</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># VisiumHD 16µm (square grid)</span></span>
<span><span class="va">spe</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/detectEdgeArtifacts.html">detectEdgeArtifacts</a></span><span class="op">(</span><span class="va">spe</span>, platform <span class="op">=</span> <span class="st">"visiumhd"</span>, resolution <span class="op">=</span> <span class="st">"16um"</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># VisiumHD 8µm (square grid)</span></span>
<span><span class="va">spe</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/detectEdgeArtifacts.html">detectEdgeArtifacts</a></span><span class="op">(</span><span class="va">spe</span>, platform <span class="op">=</span> <span class="st">"visiumhd"</span>, resolution <span class="op">=</span> <span class="st">"8um"</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
<hr>
</div>
<div class="section level4">
<h4 id="detectedgeartifacts-parameters">
<strong><code>detectEdgeArtifacts()</code> Parameters</strong><a class="anchor" aria-label="anchor" href="#detectedgeartifacts-parameters"></a>
</h4>
<p>The wrapper function accepts platform-specific parameters that are
routed to the appropriate implementation.</p>
<div class="section level5">
<h5 id="universal-parameters-all-platforms">
<strong>Universal Parameters (All Platforms)</strong><a class="anchor" aria-label="anchor" href="#universal-parameters-all-platforms"></a>
</h5>
<ul>
<li>
<p><em><code>platform</code></em> (<strong>REQUIRED</strong>) –
Character string: <code>"visium"</code> or <code>"visiumhd"</code> (case
insensitive)</p>
<ul>
<li>Determines which platform-specific function to use</li>
<li>No default value; must be explicitly specified for clarity</li>
</ul>
</li>
<li>
<p><em><code>qc_metric</code></em> (Default:
<code>"sum_gene"</code>) – Column name for QC metric used in outlier
detection</p>
<ul>
<li>Common alternatives: <code>"sum_umi"</code>,
<code>"detected"</code>, <code>"nFeature"</code>
</li>
<li>The function will auto-detect some common variants</li>
</ul>
</li>
<li>
<p><em><code>samples</code></em> (Default: <code>"sample_id"</code>)
– Column name for sample identifiers</p>
<ul>
<li>Each sample is processed independently</li>
</ul>
</li>
<li>
<p><em><code>mad_threshold</code></em> (Default: 3) – Sensitivity
for detecting outliers</p>
<ul>
<li>Lower values (1.5–2) are more sensitive</li>
<li>Higher values (3–4) are more conservative</li>
</ul>
</li>
<li>
<p><em><code>name</code></em> (Default:
<code>"edge_artifact"</code>) – Prefix for output column names</p>
<ul>
<li>Outputs: <code>[name]_edge</code>, <code>[name]_problem_id</code>,
<code>[name]_problem_size</code>
</li>
</ul>
</li>
<li><p><em><code>verbose</code></em> (Default: <code>TRUE</code>) –
Print progress messages</p></li>
<li><p><em><code>keep_intermediate</code></em> (Default:
<code>FALSE</code>) – Retain intermediate outlier detection
columns</p></li>
</ul>
<hr>
</div>
<div class="section level5">
<h5 id="standard-visium-specific-parameters">
<strong>Standard Visium-Specific Parameters</strong><a class="anchor" aria-label="anchor" href="#standard-visium-specific-parameters"></a>
</h5>
<p><em>(Used when <code>platform = "visium"</code>)</em></p>
<ul>
<li>
<p><em><code>edge_threshold</code></em> (Default: 0.75) – Minimum
proportion of a tissue boundary that must be occupied by outlier
clusters (collectively) for those clusters to be classified as edge
artifacts.</p>
<p><strong>Important Behavior:</strong> The threshold is applied to the
<strong>total coverage</strong> of all outlier clusters on each boundary
direction (North, South, East, West). If multiple clusters collectively
cover ≥ <code>edge_threshold</code> of a boundary, <strong>all clusters
touching that boundary</strong> are classified as edge artifacts, even
if no single cluster meets the threshold individually.</p>
<p><strong>Example Scenario:</strong></p>
<ul>
<li>North boundary contains 100 spots total</li>
<li>Cluster A occupies 30 boundary spots (30% coverage)</li>
<li>Cluster B occupies 50 boundary spots (50% coverage)</li>
<li>Combined coverage: 80% ≥ 75% threshold</li>
<li>
<strong>Result:</strong> Both Cluster A and Cluster B are classified
as edge artifacts</li>
</ul>
<p><strong>Rationale:</strong> Edge drying artifacts typically affect
large, continuous regions along tissue boundaries. Multiple clusters on
the same boundary often result from a single underlying technical
failure (incomplete permeabilization) and should be treated as a unified
artifact rather than independent events.</p>
<p><strong>Tuning Guidance:</strong></p>
<ul>
<li>Higher values (0.75–0.90): More conservative, captures only
large-scale boundary failures</li>
<li>Lower values (0.40–0.60): More sensitive, may flag smaller
boundary-adjacent regions</li>
<li>Very low values (&lt;0.30): Aggressive, may misclassify biological
low-expression zones as artifacts</li>
</ul>
</li>
<li>
<p><em><code>min_cluster_size</code></em> (Default: 40) – Minimum
cluster size (in spots) for morphological cleaning during focal
transformation steps</p>
<ul>
<li>Isolated “normal” regions smaller than this threshold within outlier
areas will be filled in to create contiguous artifact regions</li>
<li>
<strong>For Standard Visium:</strong> 40 spots ≈ 0.12 mm² physical
area</li>
</ul>
</li>
<li>
<p><em><code>shifted</code></em> (Default: <code>FALSE</code>) –
Apply coordinate adjustment for hexagonal grid alignment</p>
<ul>
<li>
<strong>Standard Visium typically requires
<code>shifted = TRUE</code></strong> when using array coordinates from
Space Ranger.</li>
<li>Set to <code>FALSE</code> if using pre-transformed pixel coordinates
or for VisiumHD square grids.</li>
<li>This corrects for the staggered arrangement of hexagonal spots</li>
</ul>
</li>
<li>
<p><em><code>batch_var</code></em> (Default: <code>"both"</code>) –
Determines grouping for MAD calculation</p>
<ul>
<li>Options: <code>"sample_id"</code>, <code>"slide"</code>, or
<code>"both"</code>
</li>
<li>
<code>"both"</code>: Spots flagged as outliers if below threshold in
either sample or slide grouping</li>
</ul>
</li>
</ul>
<hr>
</div>
<div class="section level5">
<h5 id="visiumhd-specific-parameters">
<strong>VisiumHD-Specific Parameters</strong><a class="anchor" aria-label="anchor" href="#visiumhd-specific-parameters"></a>
</h5>
<p><em>(Used when <code>platform = "visiumhd"</code>)</em></p>
<ul>
<li>
<em><code>resolution</code></em> (<strong>REQUIRED</strong>) –
Character string: <code>"8um"</code> or <code>"16um"</code>
<ul>
<li>Specifies the bin size of your VisiumHD data</li>
<li>This is <strong>mandatory</strong> for VisiumHD; the function will
error if not provided</li>
<li>Determines conversion from physical units (µm) to bins</li>
</ul>
</li>
<li>
<em><code>buffer_width_um</code></em> (Default: 80) – Buffer zone
width in micrometers (physical units)
<ul>
<li>Defines the edge region where artifacts are expected</li>
<li>Automatically converted to bins based on <code>resolution</code>:
<ul>
<li>At 16µm resolution: 80 µm → 5 bins</li>
<li>At 8µm resolution: 80 µm → 10 bins</li>
</ul>
</li>
<li>
<strong>Tuning guidance:</strong>
<ul>
<li>Increase (100-150 µm) for tissues with larger edge artifacts</li>
<li>Decrease (50-60 µm) for precise edge detection</li>
</ul>
</li>
</ul>
</li>
<li>
<em><code>min_cluster_area_um2</code></em> (Default: 1280) – Minimum
cluster area in square micrometers (physical units)
<ul>
<li>Clusters smaller than this will be filtered out during morphological
cleaning</li>
<li>Automatically converted to bins based on <code>resolution</code>:
<ul>
<li>At 16µm resolution: 1280 µm² → 5 bins (16×16 µm per bin)</li>
<li>At 8µm resolution: 1280 µm² → 20 bins (8×8 µm per bin)</li>
</ul>
</li>
<li>
<strong>Physical consistency:</strong> Same area threshold gives
different bin counts at different resolutions</li>
<li>Default (1280 µm²) was calibrated for 16µm resolution</li>
</ul>
</li>
<li>
<em><code>col_x</code></em> and <em><code>col_y</code></em>
(Default: <code>"array_col"</code>, <code>"array_row"</code>) – Column
names for bin coordinates
<ul>
<li>
<strong>Important:</strong> These should be <strong>bin
indices</strong>, not pixel coordinates</li>
<li>Using bin indices is much more memory-efficient than pixel
coordinates</li>
</ul>
</li>
</ul>
<p><strong>Key Difference from Visium:</strong> VisiumHD parameters are
specified in <strong>physical units (µm, µm²)</strong> rather than bin
counts. This ensures consistency across resolutions while the algorithm
handles the bin conversion internally.</p>
<hr>
</div>
</div>
<div class="section level4">
<h4 id="classifyedgeartifacts-parameters">
<strong><code>classifyEdgeArtifacts()</code>
Parameters</strong><a class="anchor" aria-label="anchor" href="#classifyedgeartifacts-parameters"></a>
</h4>
<p>The classification step is <strong>platform-independent</strong> but
requires appropriate parameter scaling.</p>
<ul>
<li>
<p><em><code>min_spots</code></em> (Default: 20) – <strong>CRITICAL
PARAMETER:</strong> Threshold (in number of spots/bins) to distinguish
<code>"large"</code> from <code>"small"</code> artifacts</p>
<p><strong>Platform-Specific Scaling Required:</strong></p>
<p>This parameter must be adjusted based on spatial resolution to
represent equivalent <strong>physical artifact sizes</strong>:</p>
<table class="table">
<colgroup>
<col width="15%">
<col width="36%">
<col width="23%">
<col width="24%">
</colgroup>
<thead><tr class="header">
<th>Platform</th>
<th>Recommended <code>min_spots</code>
</th>
<th>Physical Area</th>
<th>Scaling Factor</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><strong>Standard Visium (55µm)</strong></td>
<td><code>20-40</code></td>
<td>~0.06-0.12 mm²</td>
<td>Baseline (1×)</td>
</tr>
<tr class="even">
<td><strong>VisiumHD 16µm bins</strong></td>
<td><code>100-200</code></td>
<td>~0.026-0.051 mm²</td>
<td>~6-10× Visium</td>
</tr>
<tr class="odd">
<td><strong>VisiumHD 8µm bins</strong></td>
<td><code>400-800</code></td>
<td>~0.026-0.051 mm²</td>
<td>~20-40× Visium</td>
</tr>
</tbody>
</table>
<p><strong>Automatic Scaling Formula:</strong></p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>min_spots_HD <span class="ot">&lt;-</span> min_spots_visium × (<span class="dv">55</span> <span class="sc">/</span> bin_size_µm)²</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="co"># Example: For min_spots = 30 on Standard Visium</span></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="co"># VisiumHD 16µm: 30 × (55/16)² ≈ 354 bins</span></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a><span class="co"># VisiumHD 8µm:  30 × (55/8)²  ≈ 1,420 bins</span></span></code></pre></div>
<p><strong>Why scaling matters:</strong> The same physical artifact
(e.g., 0.1 mm² edge dryspot) will cover:</p>
<ul>
<li>Standard Visium: ~33 spots</li>
<li>VisiumHD 16µm: ~390 bins<br>
</li>
<li>VisiumHD 8µm: ~1,560 bins</li>
</ul>
<p>Without scaling, large VisiumHD artifacts would be incorrectly
classified as “small.”</p>
</li>
<li><p><em><code>qc_metric</code></em> (Default: <code>"sum_umi"</code>)
– QC metric column for validation (must exist but not directly used in
classification logic)</p></li>
<li><p><em><code>samples</code></em> (Default: <code>"sample_id"</code>)
– Sample ID column name</p></li>
<li>
<p><em><code>exclude_slides</code></em> (Default: <code>NULL</code>)
– Vector of slide IDs to exclude from edge classification</p>
<ul>
<li>Spots on these slides will have edge artifact status set to
<code>FALSE</code>
</li>
</ul>
</li>
<li><p><em><code>name</code></em> (Default:
<code>"edge_artifact"</code>) – Must match the name used in
<code><a href="../reference/detectEdgeArtifacts.html">detectEdgeArtifacts()</a></code></p></li>
</ul>
<hr>
</div>
<div class="section level4">
<h4 id="platform-comparison-summary">
<strong>Platform Comparison Summary</strong><a class="anchor" aria-label="anchor" href="#platform-comparison-summary"></a>
</h4>
<table style="width:100%;" class="table">
<colgroup>
<col width="25%">
<col width="45%">
<col width="28%">
</colgroup>
<thead><tr class="header">
<th>Feature</th>
<th>Standard Visium</th>
<th>VisiumHD</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><strong>Grid Type</strong></td>
<td>Hexagonal</td>
<td>Square</td>
</tr>
<tr class="even">
<td><strong>Requires <code>shifted</code>?</strong></td>
<td>Yes (<code>TRUE</code>)</td>
<td>No (not used)</td>
</tr>
<tr class="odd">
<td><strong>Resolution Parameter</strong></td>
<td>Not applicable</td>
<td>
<strong>Required</strong> (<code>"8um"</code> or
<code>"16um"</code>)</td>
</tr>
<tr class="even">
<td><strong>Edge Detection Method</strong></td>
<td>Morphological + boundary coverage</td>
<td>Buffer zone + morphological</td>
</tr>
<tr class="odd">
<td><strong>Parameter Units</strong></td>
<td>Spot counts</td>
<td>Physical units (µm, µm²)</td>
</tr>
<tr class="even">
<td><strong>Default <code>min_spots</code> (classify)</strong></td>
<td>20-40</td>
<td>100-200 (16µm), 400-800 (8µm)</td>
</tr>
<tr class="odd">
<td><strong>Typical Dataset Size</strong></td>
<td>~5,000 spots</td>
<td>~480k bins (16µm), ~1.9M bins (8µm)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section level3">
<h3 id="understanding-the-output-columns">Understanding the Output Columns<a class="anchor" aria-label="anchor" href="#understanding-the-output-columns"></a>
</h3>
<p>After both functions, several columns are added to
<code>colData(spe)</code>:</p>
<ul>
<li>
<strong><code>*_edge</code></strong> – Raw detection: Is the spot in
a cluster touching the tissue border? (TRUE/FALSE)<br>
</li>
<li>
<strong><code>*_problem_id</code></strong> – Raw detection: ID of
the problem area.<br>
</li>
<li>
<strong><code>*_problem_size</code></strong> – Raw detection: Size
(number of spots) of the problem area.<br>
</li>
<li>
<code>*_true_edges</code> — <strong>Intermediate:</strong> Edge
status after applying <code>exclude_slides</code> (used by
<code><a href="../reference/classifyEdgeArtifacts.html">classifyEdgeArtifacts()</a></code>).</li>
<li>
<code>*_classification</code> — <strong>Final
classification:</strong> One of <code>"not_artifact"</code>,
<code>"large_edge_artifact"</code>, <code>"small_edge_artifact"</code>,
<code>"large_interior_artifact"</code>, or
<code>"small_interior_artifact"</code>.</li>
</ul>
</div>
<div class="section level3">
<h3 id="running-the-full-workflow-standard-visium-example">Running the Full Workflow: Standard Visium Example<a class="anchor" aria-label="anchor" href="#running-the-full-workflow-standard-visium-example"></a>
</h3>
<p>This package includes <code>spe_vignette</code>, a lightweight
<code>SpatialExperiment</code> object derived from a human hippocampus
Visium sample.</p>
<p><strong>This vignette will load this raw-like object and run the full
<code>SpatialDryArtifacts</code> workflow on it live.</strong></p>
<p><strong>Note:</strong> To meet package size requirements (&lt; 5MB),
this object has been subset (e.g., to coding genes) and sparsified, but
<strong>no artifact detection has been run.</strong> We will perform
those steps now.</p>
<div class="section level4">
<h4 id="data-preparation-converting-to-dense-matrix">Data Preparation: Converting to Dense Matrix<a class="anchor" aria-label="anchor" href="#data-preparation-converting-to-dense-matrix"></a>
</h4>
<p>The underlying spatial clustering functions in this package currently
require a <strong>dense matrix</strong> to perform coordinate-based
calculations. We must first convert the sparse <code>counts</code> assay
in our <code>spe_vignette</code> object to a standard (dense)
matrix.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">spe_vignette</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Loaded data dimensions:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">spe_vignette</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Loaded data dimensions: 12971 4965</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">assay</a></span><span class="op">(</span><span class="va">spe_vignette</span>, <span class="st">"counts"</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/coerce.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">assay</a></span><span class="op">(</span><span class="va">spe_vignette</span>, <span class="st">"counts"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">colData</a></span><span class="op">(</span><span class="va">spe_vignette</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">colData</a></span><span class="op">(</span><span class="va">spe_vignette</span><span class="op">)</span><span class="op">)</span> <span class="op">==</span> <span class="st">"sum"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"sum_umi"</span></span>
<span></span>
<span><span class="va">spe_detected</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/detectEdgeArtifacts.html">detectEdgeArtifacts</a></span><span class="op">(</span></span>
<span>  <span class="va">spe_vignette</span>,</span>
<span>  platform <span class="op">=</span> <span class="st">"visium"</span>,        <span class="co"># IMPORTANT: Specify Standard Visium platform</span></span>
<span>  qc_metric <span class="op">=</span> <span class="st">"sum_umi"</span>,         </span>
<span>  samples <span class="op">=</span> <span class="st">"sample_id"</span>,</span>
<span>  shifted <span class="op">=</span> <span class="cn">TRUE</span>,             <span class="co"># Hexagonal grid coordinate adjustment</span></span>
<span>  batch_var <span class="op">=</span> <span class="st">"sample_id"</span>, </span>
<span>  mad_threshold <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  edge_threshold <span class="op">=</span> <span class="fl">0.75</span>,</span>
<span>  name <span class="op">=</span> <span class="st">"edge_artifact"</span> </span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Detecting edges...</span></span>
<span><span class="co">#&gt;   Sample V11L05-335_C1: 74 edge spots detected</span></span>
<span><span class="co">#&gt; Finding problem areas...</span></span>
<span><span class="co">#&gt; Removed intermediate columns: lg10_sum_umi, sum_umi_3MAD_outlier_sample, sum_umi_3MAD_outlier_binary</span></span>
<span><span class="co">#&gt; Edge artifact detection completed!</span></span>
<span><span class="co">#&gt;   Total edge spots: 74</span></span>
<span><span class="co">#&gt;   Total problem area spots: 78</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\n=== RESULTS ===\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; === RESULTS ===</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/table.html" class="external-link">table</a></span><span class="op">(</span>Edge_Detected <span class="op">=</span> <span class="va">spe_detected</span><span class="op">$</span><span class="va">edge_artifact_edge</span><span class="op">)</span></span>
<span><span class="co">#&gt; Edge_Detected</span></span>
<span><span class="co">#&gt; FALSE  TRUE </span></span>
<span><span class="co">#&gt;  4891    74</span></span>
<span></span>
<span><span class="co"># Classification with Standard Visium parameters</span></span>
<span><span class="va">spe_classified</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/classifyEdgeArtifacts.html">classifyEdgeArtifacts</a></span><span class="op">(</span></span>
<span>  <span class="va">spe_detected</span>,       </span>
<span>  min_spots <span class="op">=</span> <span class="fl">20</span>,  </span>
<span>  name <span class="op">=</span> <span class="st">"edge_artifact"</span> </span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Classifying artifacts spots...</span></span>
<span><span class="co">#&gt; Classification added: edge_artifact_classification</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Classification summary:</span></span>
<span><span class="co">#&gt;   not_artifact: 4887 spots</span></span>
<span><span class="co">#&gt;   small_edge_artifact: 74 spots</span></span>
<span><span class="co">#&gt;   small_interior_artifact: 4 spots</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\n=== Classification Results ===\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; === Classification Results ===</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">spe_classified</span><span class="op">$</span><span class="va">edge_artifact_classification</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;            not_artifact     small_edge_artifact small_interior_artifact </span></span>
<span><span class="co">#&gt;                    4887                      74                       4</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="visiumhd-workflow-example">VisiumHD Workflow Example<a class="anchor" aria-label="anchor" href="#visiumhd-workflow-example"></a>
</h3>
<p>For VisiumHD data, the workflow is identical <strong>except for
parameter scaling</strong>. Here’s a complete example showing how to
adapt parameters for VisiumHD:</p>
<div class="section level4">
<h4 id="visiumhd-16µm-resolution-example">VisiumHD 16µm Resolution Example<a class="anchor" aria-label="anchor" href="#visiumhd-16%C2%B5m-resolution-example"></a>
</h4>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># This is a pseudo-example demonstrating VisiumHD 16µm workflow</span></span>
<span><span class="co"># Assumes you have loaded a VisiumHD SpatialExperiment object as 'spe_hd16'</span></span>
<span></span>
<span><span class="co"># Step 1: Ensure required QC metrics are calculated</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">scuttle</span><span class="op">)</span></span>
<span><span class="va">spe_hd16</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/scuttle/man/addPerCellQCMetrics.html" class="external-link">addPerCellQCMetrics</a></span><span class="op">(</span><span class="va">spe_hd16</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Step 2: Detection Phase - VisiumHD uses square grid (no 'shifted' needed)</span></span>
<span><span class="va">spe_hd16_detected</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/detectEdgeArtifacts.html">detectEdgeArtifacts</a></span><span class="op">(</span></span>
<span>  <span class="va">spe_hd16</span>,</span>
<span>  platform <span class="op">=</span> <span class="st">"visiumhd"</span>,       <span class="co"># Specify VisiumHD platform</span></span>
<span>  resolution <span class="op">=</span> <span class="st">"16um"</span>,          <span class="co"># REQUIRED for VisiumHD</span></span>
<span>  qc_metric <span class="op">=</span> <span class="st">"sum_umi"</span>,            <span class="co"># or "sum" depending on your colData</span></span>
<span>  samples <span class="op">=</span> <span class="st">"sample_id"</span>,</span>
<span>  buffer_width_um <span class="op">=</span> <span class="fl">100</span>,        <span class="co"># VisiumHD-specific parameter</span></span>
<span>  mad_threshold <span class="op">=</span> <span class="fl">2.5</span>,</span>
<span>  edge_threshold <span class="op">=</span> <span class="fl">0.75</span>,</span>
<span>  name <span class="op">=</span> <span class="st">"edge_artifact"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Step 3: Classification Phase - CRITICAL: Scale min_spots for VisiumHD resolution</span></span>
<span><span class="co"># For 16µm bins, use ~6-10× the Standard Visium threshold</span></span>
<span><span class="va">min_spots_16um</span> <span class="op">&lt;-</span> <span class="fl">30</span> <span class="op">*</span> <span class="op">(</span><span class="fl">55</span><span class="op">/</span><span class="fl">16</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span>  <span class="co"># ≈ 354 bins</span></span>
<span></span>
<span><span class="va">spe_hd16_classified</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/classifyEdgeArtifacts.html">classifyEdgeArtifacts</a></span><span class="op">(</span></span>
<span>  <span class="va">spe_hd16_detected</span>,</span>
<span>  qc_metric <span class="op">=</span> <span class="st">"sum_umi"</span>,</span>
<span>  min_spots <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/math-generics.html" class="external-link">round</a></span><span class="op">(</span><span class="va">min_spots_16um</span><span class="op">)</span>,  <span class="co"># ~350 bins</span></span>
<span>  name <span class="op">=</span> <span class="st">"edge_artifact"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Visualization (same approach as Standard Visium)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">spe_hd16_classified</span><span class="op">$</span><span class="va">edge_artifact_classification</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="visiumhd-8µm-resolution-example">VisiumHD 8µm Resolution Example<a class="anchor" aria-label="anchor" href="#visiumhd-8%C2%B5m-resolution-example"></a>
</h4>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># This is a pseudo-example demonstrating VisiumHD 8µm workflow</span></span>
<span><span class="co"># Assumes you have loaded a VisiumHD 8µm SpatialExperiment object as 'spe_hd8'</span></span>
<span></span>
<span><span class="co"># Step 1: QC metrics</span></span>
<span><span class="va">spe_hd8</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/scuttle/man/addPerCellQCMetrics.html" class="external-link">addPerCellQCMetrics</a></span><span class="op">(</span><span class="va">spe_hd8</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Step 2: Detection Phase</span></span>
<span><span class="va">spe_hd8_detected</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/detectEdgeArtifacts.html">detectEdgeArtifacts</a></span><span class="op">(</span></span>
<span>  <span class="va">spe_hd8</span>,</span>
<span>  platform <span class="op">=</span> <span class="st">"visiumhd"</span>,       <span class="co"># Specify VisiumHD platform</span></span>
<span>  resolution <span class="op">=</span> <span class="st">"8um"</span>,           <span class="co"># REQUIRED: Specify 8µm resolution</span></span>
<span>  qc_metric <span class="op">=</span> <span class="st">"sum_umi"</span>,</span>
<span>  samples <span class="op">=</span> <span class="st">"sample_id"</span>,</span>
<span>  buffer_width_um <span class="op">=</span> <span class="fl">100</span>,        <span class="co"># Buffer zone in micrometers</span></span>
<span>  mad_threshold <span class="op">=</span> <span class="fl">2.5</span>,</span>
<span>  edge_threshold <span class="op">=</span> <span class="fl">0.75</span>,</span>
<span>  name <span class="op">=</span> <span class="st">"edge_artifact"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Step 3: Classification with 8µm-appropriate threshold</span></span>
<span><span class="co"># For 8µm bins, use ~20-40× the Standard Visium threshold</span></span>
<span><span class="va">min_spots_8um</span> <span class="op">&lt;-</span> <span class="fl">30</span> <span class="op">*</span> <span class="op">(</span><span class="fl">55</span><span class="op">/</span><span class="fl">8</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span>  <span class="co"># ≈ 1,420 bins</span></span>
<span></span>
<span><span class="va">spe_hd8_classified</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/classifyEdgeArtifacts.html">classifyEdgeArtifacts</a></span><span class="op">(</span></span>
<span>  <span class="va">spe_hd8_detected</span>,</span>
<span>  qc_metric <span class="op">=</span> <span class="st">"sum_umi"</span>,</span>
<span>  min_spots <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/math-generics.html" class="external-link">round</a></span><span class="op">(</span><span class="va">min_spots_8um</span><span class="op">)</span>,  <span class="co"># ~1,400 bins</span></span>
<span>  name <span class="op">=</span> <span class="st">"edge_artifact"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">spe_hd8_classified</span><span class="op">$</span><span class="va">edge_artifact_classification</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="key-visiumhd-considerations">Key VisiumHD Considerations<a class="anchor" aria-label="anchor" href="#key-visiumhd-considerations"></a>
</h4>
<p><strong>Platform-Specific Function Calls:</strong></p>
<table class="table">
<colgroup>
<col width="22%">
<col width="31%">
<col width="46%">
</colgroup>
<thead><tr class="header">
<th>Platform</th>
<th>Function Call</th>
<th>Required Parameters</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><strong>Standard Visium</strong></td>
<td><code>detectEdgeArtifacts(..., platform="visium")</code></td>
<td><code>shifted=TRUE</code></td>
</tr>
<tr class="even">
<td><strong>VisiumHD 16µm</strong></td>
<td><code>detectEdgeArtifacts(..., platform="visiumhd", resolution="16um")</code></td>
<td><code>resolution</code></td>
</tr>
<tr class="odd">
<td><strong>VisiumHD 8µm</strong></td>
<td><code>detectEdgeArtifacts(..., platform="visiumhd", resolution="8um")</code></td>
<td><code>resolution</code></td>
</tr>
</tbody>
</table>
<p><strong>Parameter Recommendations by Platform:</strong></p>
<table class="table">
<thead><tr class="header">
<th>Parameter</th>
<th>Standard Visium</th>
<th>VisiumHD 16µm</th>
<th>VisiumHD 8µm</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>platform</code></td>
<td><code>"visium"</code></td>
<td><code>"visiumhd"</code></td>
<td><code>"visiumhd"</code></td>
</tr>
<tr class="even">
<td><code>resolution</code></td>
<td>N/A (not used)</td>
<td><code>"16um"</code></td>
<td><code>"8um"</code></td>
</tr>
<tr class="odd">
<td><code>shifted</code></td>
<td><code>TRUE</code></td>
<td>N/A (handled internally)</td>
<td>N/A</td>
</tr>
<tr class="even">
<td><code>buffer_width_um</code></td>
<td>N/A</td>
<td>
<code>100</code> (default)</td>
<td>
<code>100</code> (default)</td>
</tr>
<tr class="odd">
<td><code>mad_threshold</code></td>
<td>1.5-3.0</td>
<td>2.0-3.0</td>
<td>2.0-3.0</td>
</tr>
<tr class="even">
<td>
<code>min_spots</code> (classify)</td>
<td>20-40</td>
<td>100-200</td>
<td>400-800</td>
</tr>
<tr class="odd">
<td>Grid Type</td>
<td>Hexagonal</td>
<td>Square</td>
<td>Square</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section level3">
<h3 id="visualization-qc-metrics-and-detection-results">Visualization: QC Metrics and Detection Results<a class="anchor" aria-label="anchor" href="#visualization-qc-metrics-and-detection-results"></a>
</h3>
<p>We’ll create a comprehensive visualization showing QC metrics,
detection results, and detailed cluster information:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/drighelli/SpatialExperiment" class="external-link">SpatialExperiment</a></span><span class="op">)</span> </span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">colData</a></span><span class="op">(</span><span class="va">spe_classified</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">plot_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">plot_data</span>, <span class="fu"><a href="https://rspatial.github.io/terra/reference/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SpatialExperiment/man/SpatialExperiment-methods.html" class="external-link">spatialCoords</a></span><span class="op">(</span><span class="va">spe_classified</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">plot_data_in_tissue</span> <span class="op">&lt;-</span> <span class="va">plot_data</span><span class="op">[</span><span class="va">plot_data</span><span class="op">$</span><span class="va">in_tissue</span>, <span class="op">]</span></span>
<span></span>
<span><span class="va">base_theme</span> <span class="op">&lt;-</span> <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme</span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">12</span>, hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>          legend.position <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot 1: UMI Counts</span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">plot_data_in_tissue</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">pxl_col_in_fullres</span>, y <span class="op">=</span> <span class="va">pxl_row_in_fullres</span>, </span>
<span>                                       color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log10</a></span><span class="op">(</span><span class="va">sum_umi</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_viridis_c</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"log10(UMI)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"A. UMI Counts"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="va">base_theme</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_fixed</span><span class="op">(</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># Plot 2: Detected Genes</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="st">"detected"</span> <span class="op"><a href="https://rspatial.github.io/terra/reference/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">plot_data_in_tissue</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">plot_data_in_tissue</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">pxl_col_in_fullres</span>, y <span class="op">=</span> <span class="va">pxl_row_in_fullres</span>, </span>
<span>                                         color <span class="op">=</span> <span class="va">detected</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_point</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">scale_color_viridis_c</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Genes"</span>, option <span class="op">=</span> <span class="st">"plasma"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"B. Detected Genes"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="va">base_theme</span> <span class="op">+</span></span>
<span>    <span class="fu">coord_fixed</span><span class="op">(</span><span class="op">)</span> </span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"B. Detected Genes (Data N/A)"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Plot 3: Raw Detection (Any Problem Area)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="st">"edge_artifact_problem_id"</span> <span class="op"><a href="https://rspatial.github.io/terra/reference/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">plot_data_in_tissue</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>   <span class="va">p3</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">plot_data_in_tissue</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">pxl_col_in_fullres</span>, y <span class="op">=</span> <span class="va">pxl_row_in_fullres</span>, </span>
<span>                                          color <span class="op">=</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">edge_artifact_problem_id</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu">geom_point</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu">scale_color_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"FALSE"</span> <span class="op">=</span> <span class="st">"lightgray"</span>, <span class="st">"TRUE"</span> <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span>, </span>
<span>                       name <span class="op">=</span> <span class="st">"Problem?"</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"C. Raw Detection (All Problem Areas)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="va">base_theme</span> <span class="op">+</span></span>
<span>     <span class="fu">coord_fixed</span><span class="op">(</span><span class="op">)</span> </span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>   <span class="va">p3</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"C. Raw Detection (Data N/A)"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Plot 4: Cluster IDs</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="st">"edge_artifact_problem_id"</span> <span class="op"><a href="https://rspatial.github.io/terra/reference/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">plot_data_in_tissue</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">plot_data_in_tissue</span><span class="op">$</span><span class="va">cluster_display</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span>  </span>
<span>  <span class="va">has_cluster</span> <span class="op">&lt;-</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">plot_data_in_tissue</span><span class="op">$</span><span class="va">edge_artifact_problem_id</span><span class="op">)</span></span>
<span>  <span class="va">plot_data_in_tissue</span><span class="op">$</span><span class="va">cluster_display</span><span class="op">[</span><span class="va">has_cluster</span><span class="op">]</span> <span class="op">&lt;-</span> </span>
<span>    <span class="va">plot_data_in_tissue</span><span class="op">$</span><span class="va">edge_artifact_problem_id</span><span class="op">[</span><span class="va">has_cluster</span><span class="op">]</span></span>
<span></span>
<span>  <span class="va">n_clusters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">plot_data_in_tissue</span><span class="op">$</span><span class="va">cluster_display</span><span class="op">[</span><span class="va">has_cluster</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">p4</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">plot_data_in_tissue</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">pxl_col_in_fullres</span>, y <span class="op">=</span> <span class="va">pxl_row_in_fullres</span>, </span>
<span>                                         color <span class="op">=</span> <span class="va">cluster_display</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_point</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">scale_color_discrete</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Cluster ID"</span>, na.value <span class="op">=</span> <span class="st">"lightgray"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggtitle</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"D. Problem Area Clusters (n="</span>, <span class="va">n_clusters</span>, <span class="st">")"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="va">base_theme</span> <span class="op">+</span></span>
<span>    <span class="fu">coord_fixed</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme</span><span class="op">(</span>legend.key.size <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">0.3</span>, <span class="st">"cm"</span><span class="op">)</span>,</span>
<span>          legend.text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">8</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="va">p4</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"D. Cluster IDs (Data N/A)"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Plot 5: Edge vs Interior Separation</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="st">"edge_artifact_edge"</span> <span class="op"><a href="https://rspatial.github.io/terra/reference/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">plot_data_in_tissue</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">plot_data_in_tissue</span><span class="op">$</span><span class="va">artifact_type</span> <span class="op">&lt;-</span> <span class="st">"Normal"</span></span>
<span>  </span>
<span>  <span class="co"># Mark edge artifacts</span></span>
<span>  <span class="va">plot_data_in_tissue</span><span class="op">$</span><span class="va">artifact_type</span><span class="op">[</span><span class="va">plot_data_in_tissue</span><span class="op">$</span><span class="va">edge_artifact_edge</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Edge Artifact"</span></span>
<span>  </span>
<span>  <span class="co"># Mark interior problem areas (not edges)</span></span>
<span>  <span class="va">interior_mask</span> <span class="op">&lt;-</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">plot_data_in_tissue</span><span class="op">$</span><span class="va">edge_artifact_problem_id</span><span class="op">)</span> <span class="op">&amp;</span> </span>
<span>                   <span class="op">!</span><span class="va">plot_data_in_tissue</span><span class="op">$</span><span class="va">edge_artifact_edge</span></span>
<span>  <span class="va">plot_data_in_tissue</span><span class="op">$</span><span class="va">artifact_type</span><span class="op">[</span><span class="va">interior_mask</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Interior Problem"</span></span>
<span>  </span>
<span>  <span class="va">p5</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">plot_data_in_tissue</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">pxl_col_in_fullres</span>, y <span class="op">=</span> <span class="va">pxl_row_in_fullres</span>, </span>
<span>                                         color <span class="op">=</span> <span class="va">artifact_type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_point</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">scale_color_manual</span><span class="op">(</span></span>
<span>      values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Normal"</span> <span class="op">=</span> <span class="st">"lightgray"</span>, </span>
<span>                 <span class="st">"Edge Artifact"</span> <span class="op">=</span> <span class="st">"red"</span>,</span>
<span>                 <span class="st">"Interior Problem"</span> <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span>,</span>
<span>      name <span class="op">=</span> <span class="st">"Artifact Type"</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"E. Edge vs Interior Distinction"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="va">base_theme</span> <span class="op">+</span></span>
<span>    <span class="fu">coord_fixed</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="va">p5</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"E. Edge vs Interior (Data N/A)"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Plot 6: Final Hierarchical Classification </span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="st">"edge_artifact_classification"</span> <span class="op"><a href="https://rspatial.github.io/terra/reference/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">plot_data_in_tissue</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">p6</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">plot_data_in_tissue</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">pxl_col_in_fullres</span>, y <span class="op">=</span> <span class="va">pxl_row_in_fullres</span>, </span>
<span>                                         color <span class="op">=</span> <span class="va">edge_artifact_classification</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_point</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">scale_color_manual</span><span class="op">(</span></span>
<span>      values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"not_artifact"</span> <span class="op">=</span> <span class="st">"lightgray"</span>, </span>
<span>                 <span class="st">"large_edge_artifact"</span> <span class="op">=</span> <span class="st">"red"</span>,</span>
<span>                 <span class="st">"small_edge_artifact"</span> <span class="op">=</span> <span class="st">"orange"</span>,</span>
<span>                 <span class="st">"large_interior_artifact"</span> <span class="op">=</span> <span class="st">"blue"</span>,</span>
<span>                 <span class="st">"small_interior_artifact"</span> <span class="op">=</span> <span class="st">"cyan"</span><span class="op">)</span>,</span>
<span>      name <span class="op">=</span> <span class="st">"Final Class"</span>,</span>
<span>      na.value <span class="op">=</span> <span class="st">"grey50"</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"F. Final Hierarchical Classification"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="va">base_theme</span> <span class="op">+</span></span>
<span>    <span class="fu">coord_fixed</span><span class="op">(</span><span class="op">)</span> </span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="va">p6</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"F. Final Classification (Data N/A)"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Combine all plots in a 3x2 layout</span></span>
<span><span class="op">(</span><span class="va">p1</span> <span class="op">|</span> <span class="va">p2</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">p3</span> <span class="op">|</span> <span class="va">p4</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">p5</span> <span class="op">|</span> <span class="va">p6</span><span class="op">)</span></span></code></pre></div>
<p><img src="hippocampus-edge-detection_files/figure-html/plot-1.png" class="r-plt" alt="" width="1152"></p>
</div>
<div class="section level3">
<h3 id="classification-summary">Classification Summary<a class="anchor" aria-label="anchor" href="#classification-summary"></a>
</h3>
<p>Let’s examine the enhanced classification system:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"--- Final Classification Summary (`edge_artifact_classification`) ---\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; --- Final Classification Summary (`edge_artifact_classification`) ---</span></span>
<span><span class="co"># Use the 'spe_classified' object we created in the step above</span></span>
<span><span class="va">final_summary</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">spe_classified</span><span class="op">$</span><span class="va">edge_artifact_classification</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">final_summary</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;            not_artifact     small_edge_artifact small_interior_artifact </span></span>
<span><span class="co">#&gt;                    4887                      74                       4</span></span>
<span></span>
<span><span class="va">final_pct</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/math-generics.html" class="external-link">round</a></span><span class="op">(</span><span class="fl">100</span> <span class="op">*</span> <span class="va">final_summary</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">final_summary</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">final_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  Classification <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">final_summary</span><span class="op">)</span>,</span>
<span>  Count <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">final_summary</span><span class="op">)</span>,</span>
<span>  Percentage <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">final_pct</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">final_df</span><span class="op">)</span></span>
<span><span class="co">#&gt;            Classification Count Percentage</span></span>
<span><span class="co">#&gt; 1            not_artifact  4887      98.43</span></span>
<span><span class="co">#&gt; 2     small_edge_artifact    74       1.49</span></span>
<span><span class="co">#&gt; 3 small_interior_artifact     4       0.08</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\n\n"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"--- Raw Edge Detection Summary (`edge_artifact_edge`) ---\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; --- Raw Edge Detection Summary (`edge_artifact_edge`) ---</span></span>
<span><span class="co"># Use the 'spe_classified' object and the new column name</span></span>
<span><span class="va">edge_summary</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">spe_classified</span><span class="op">$</span><span class="va">edge_artifact_edge</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">edge_summary</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; FALSE  TRUE </span></span>
<span><span class="co">#&gt;  4891    74</span></span>
<span></span>
<span><span class="va">edge_pct</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/math-generics.html" class="external-link">round</a></span><span class="op">(</span><span class="fl">100</span> <span class="op">*</span> <span class="va">edge_summary</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">edge_summary</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">edge_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  Flagged_As_Edge <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">edge_summary</span><span class="op">)</span>,</span>
<span>  Count <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">edge_summary</span><span class="op">)</span>,</span>
<span>  Percentage <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">edge_pct</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">edge_df</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Flagged_As_Edge Count Percentage</span></span>
<span><span class="co">#&gt; 1           FALSE  4891      98.51</span></span>
<span><span class="co">#&gt; 2            TRUE    74       1.49</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="quality-control-validation">Quality Control Validation<a class="anchor" aria-label="anchor" href="#quality-control-validation"></a>
</h3>
<p>Finally, let’s validate that flagged spots have lower quality
metrics:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">in_tissue_data</span> <span class="op">&lt;-</span> <span class="va">spe_classified</span><span class="op">[</span>, <span class="va">spe_classified</span><span class="op">$</span><span class="va">in_tissue</span><span class="op">]</span></span>
<span></span>
<span><span class="va">qc_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  sum_umi <span class="op">=</span> <span class="va">in_tissue_data</span><span class="op">$</span><span class="va">sum_umi</span>,</span>
<span>  detected_genes <span class="op">=</span> <span class="va">in_tissue_data</span><span class="op">$</span><span class="va">detected</span>,</span>
<span>  flagged <span class="op">=</span> <span class="va">in_tissue_data</span><span class="op">$</span><span class="va">edge_artifact_edge</span> </span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># --- Calculate Median Differences ---</span></span>
<span><span class="va">flagged_umi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/summarize-generics.html" class="external-link">median</a></span><span class="op">(</span><span class="va">qc_data</span><span class="op">$</span><span class="va">sum_umi</span><span class="op">[</span><span class="va">qc_data</span><span class="op">$</span><span class="va">flagged</span><span class="op">]</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">nonflagged_umi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/summarize-generics.html" class="external-link">median</a></span><span class="op">(</span><span class="va">qc_data</span><span class="op">$</span><span class="va">sum_umi</span><span class="op">[</span><span class="op">!</span><span class="va">qc_data</span><span class="op">$</span><span class="va">flagged</span><span class="op">]</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">flagged_gene</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/summarize-generics.html" class="external-link">median</a></span><span class="op">(</span><span class="va">qc_data</span><span class="op">$</span><span class="va">detected_genes</span><span class="op">[</span><span class="va">qc_data</span><span class="op">$</span><span class="va">flagged</span><span class="op">]</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">nonflagged_gene</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/summarize-generics.html" class="external-link">median</a></span><span class="op">(</span><span class="va">qc_data</span><span class="op">$</span><span class="va">detected_genes</span><span class="op">[</span><span class="op">!</span><span class="va">qc_data</span><span class="op">$</span><span class="va">flagged</span><span class="op">]</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"QC Validation Results (comparing raw edge detection flag):\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; QC Validation Results (comparing raw edge detection flag):</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Flagged spots - Median UMI:"</span>, <span class="fu"><a href="https://rspatial.github.io/terra/reference/math-generics.html" class="external-link">round</a></span><span class="op">(</span><span class="va">flagged_umi</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Flagged spots - Median UMI: 120</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Non-flagged spots - Median UMI:"</span>, <span class="fu"><a href="https://rspatial.github.io/terra/reference/math-generics.html" class="external-link">round</a></span><span class="op">(</span><span class="va">nonflagged_umi</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Non-flagged spots - Median UMI: 1784</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"UMI difference:"</span>, <span class="fu"><a href="https://rspatial.github.io/terra/reference/math-generics.html" class="external-link">round</a></span><span class="op">(</span><span class="va">nonflagged_umi</span> <span class="op">-</span> <span class="va">flagged_umi</span><span class="op">)</span>, <span class="st">"\n\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; UMI difference: 1664</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Flagged spots - Median Detected Genes:"</span>, <span class="fu"><a href="https://rspatial.github.io/terra/reference/math-generics.html" class="external-link">round</a></span><span class="op">(</span><span class="va">flagged_gene</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Flagged spots - Median Detected Genes: 106</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Non-flagged spots - Median Detected Genes:"</span>, <span class="fu"><a href="https://rspatial.github.io/terra/reference/math-generics.html" class="external-link">round</a></span><span class="op">(</span><span class="va">nonflagged_gene</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Non-flagged spots - Median Detected Genes: 1019</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Gene difference:"</span>, <span class="fu"><a href="https://rspatial.github.io/terra/reference/math-generics.html" class="external-link">round</a></span><span class="op">(</span><span class="va">nonflagged_gene</span> <span class="op">-</span> <span class="va">flagged_gene</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Gene difference: 912</span></span>
<span></span>
<span><span class="va">qc_data</span><span class="op">$</span><span class="va">flag_status</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">qc_data</span><span class="op">$</span><span class="va">flagged</span>, <span class="st">"Flagged (Raw Edge)"</span>, <span class="st">"Non-Flagged"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">validation_plot</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">qc_data</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">flag_status</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log10</a></span><span class="op">(</span><span class="va">sum_umi</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span>, fill <span class="op">=</span> <span class="va">flag_status</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_boxplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Flagged (Raw Edge)"</span> <span class="op">=</span> <span class="st">"lightcoral"</span>, <span class="st">"Non-Flagged"</span> <span class="op">=</span> <span class="st">"lightblue"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"QC Validation: UMI Counts in Raw Edge vs Non-Edge Spots"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Raw Edge Detection Status"</span>, y <span class="op">=</span> <span class="st">"log10(UMI Count + 1)"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">validation_plot</span><span class="op">)</span></span></code></pre></div>
<p><img src="hippocampus-edge-detection_files/figure-html/validation-1.png" class="r-plt" alt="" width="700"></p>
</div>
<div class="section level3">
<h3 id="filtering-out-problematic-spots-optional">Filtering Out Problematic Spots (Optional)<a class="anchor" aria-label="anchor" href="#filtering-out-problematic-spots-optional"></a>
</h3>
<p>Based on the new classifications, users can make informed decisions
about filtering. For example, you might decide to remove all
<strong>edge artifacts</strong> (both large and small) while keeping
<strong>interior artifacts</strong> for further review.</p>
<p>Here’s how you can filter the <code>SpatialExperiment</code> object
to remove all spots classified as both
<code>"large_edge_artifact"</code> or
<code>"small_edge_artifact"</code>:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="st">"edge_artifact_classification"</span> <span class="op"><a href="https://rspatial.github.io/terra/reference/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">colData</a></span><span class="op">(</span><span class="va">spe_classified</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">spots_to_keep</span> <span class="op">&lt;-</span> <span class="op">!</span><span class="va">spe_classified</span><span class="op">$</span><span class="va">edge_artifact_classification</span> <span class="op"><a href="https://rspatial.github.io/terra/reference/match.html" class="external-link">%in%</a></span> </span>
<span>                      <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"large_edge_artifact"</span>, <span class="st">"small_edge_artifact"</span><span class="op">)</span></span>
<span>  <span class="va">spe_filtered</span> <span class="op">&lt;-</span> <span class="va">spe_classified</span><span class="op">[</span>, <span class="va">spots_to_keep</span><span class="op">]</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Original number of spots:"</span>, <span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">spe_classified</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Number of spots after filtering:"</span>, <span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">spe_filtered</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Classification column not found. Filtering step skipped.\n"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; Original number of spots: 4965 </span></span>
<span><span class="co">#&gt; Number of spots after filtering: 4891</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot_data_before</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">colData</a></span><span class="op">(</span><span class="va">spe_classified</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">coords_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SpatialExperiment/man/SpatialExperiment-methods.html" class="external-link">spatialCoords</a></span><span class="op">(</span><span class="va">spe_classified</span><span class="op">)</span></span>
<span><span class="va">plot_data_before</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">plot_data_before</span>, <span class="fu"><a href="https://rspatial.github.io/terra/reference/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">coords_mat</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">plot_data_before_in_tissue</span> <span class="op">&lt;-</span> <span class="va">plot_data_before</span><span class="op">[</span><span class="va">plot_data_before</span><span class="op">$</span><span class="va">in_tissue</span>, <span class="op">]</span></span>
<span></span>
<span><span class="va">plot_data_after</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">colData</a></span><span class="op">(</span><span class="va">spe_filtered</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">spe_filtered</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">coords_mat_after</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SpatialExperiment/man/SpatialExperiment-methods.html" class="external-link">spatialCoords</a></span><span class="op">(</span><span class="va">spe_filtered</span><span class="op">)</span></span>
<span>  <span class="va">plot_data_after</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">plot_data_after</span>, <span class="fu"><a href="https://rspatial.github.io/terra/reference/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">coords_mat_after</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">base_theme</span> <span class="op">&lt;-</span> <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme</span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">12</span>, hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>          legend.position <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p1_umi_before</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">plot_data_before_in_tissue</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">pxl_col_in_fullres</span>, y <span class="op">=</span> <span class="va">pxl_row_in_fullres</span>, color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log10</a></span><span class="op">(</span><span class="va">sum_umi</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_viridis_c</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"log10(UMI)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"UMI Counts (Before Filtering)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="va">base_theme</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_fixed</span><span class="op">(</span><span class="op">)</span> </span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">spe_filtered</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">p2_umi_after</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">plot_data_after</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">pxl_col_in_fullres</span>, y <span class="op">=</span> <span class="va">pxl_row_in_fullres</span>, color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log10</a></span><span class="op">(</span><span class="va">sum_umi</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_point</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">scale_color_viridis_c</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"log10(UMI)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"UMI Counts (After Filtering)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="va">base_theme</span> <span class="op">+</span></span>
<span>    <span class="fu">coord_fixed</span><span class="op">(</span><span class="op">)</span> </span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="va">p2_umi_after</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"UMI Counts (After Filtering - No Spots)"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">p3_class_before</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">plot_data_before_in_tissue</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">pxl_col_in_fullres</span>, y <span class="op">=</span> <span class="va">pxl_row_in_fullres</span>, color <span class="op">=</span> <span class="va">edge_artifact_classification</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span></span>
<span>    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"not_artifact"</span> <span class="op">=</span> <span class="st">"lightgray"</span>, </span>
<span>               <span class="st">"large_edge_artifact"</span> <span class="op">=</span> <span class="st">"red"</span>,</span>
<span>               <span class="st">"small_edge_artifact"</span> <span class="op">=</span> <span class="st">"orange"</span>,</span>
<span>               <span class="st">"large_interior_artifact"</span> <span class="op">=</span> <span class="st">"blue"</span>,</span>
<span>               <span class="st">"small_interior_artifact"</span> <span class="op">=</span> <span class="st">"cyan"</span><span class="op">)</span>,</span>
<span>    name <span class="op">=</span> <span class="st">"Final Class"</span>,</span>
<span>    na.value<span class="op">=</span><span class="st">"grey50"</span>,</span>
<span>    drop <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Classification (Before Filtering)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="va">base_theme</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_fixed</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">spe_filtered</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">p4_class_after</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">plot_data_after</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">pxl_col_in_fullres</span>, y <span class="op">=</span> <span class="va">pxl_row_in_fullres</span>, color <span class="op">=</span> <span class="va">edge_artifact_classification</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_point</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">scale_color_manual</span><span class="op">(</span></span>
<span>      values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"not_artifact"</span> <span class="op">=</span> <span class="st">"lightgray"</span>, </span>
<span>                 <span class="st">"large_edge_artifact"</span> <span class="op">=</span> <span class="st">"red"</span>,</span>
<span>                 <span class="st">"small_edge_artifact"</span> <span class="op">=</span> <span class="st">"orange"</span>,</span>
<span>                 <span class="st">"large_interior_artifact"</span> <span class="op">=</span> <span class="st">"blue"</span>,</span>
<span>                 <span class="st">"small_interior_artifact"</span> <span class="op">=</span> <span class="st">"cyan"</span><span class="op">)</span>,</span>
<span>      name <span class="op">=</span> <span class="st">"Final Class"</span>,</span>
<span>      na.value<span class="op">=</span><span class="st">"grey50"</span>,</span>
<span>      drop <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Classification (After Filtering)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="va">base_theme</span> <span class="op">+</span></span>
<span>    <span class="fu">coord_fixed</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="va">p4_class_after</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Classification (After Filtering - No Spots)"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">combined_filtering_plot_2x2</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">p1_umi_before</span> <span class="op">|</span> <span class="va">p2_umi_after</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">p3_class_before</span> <span class="op">|</span> <span class="va">p4_class_after</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">combined_filtering_plot_2x2</span><span class="op">)</span></span></code></pre></div>
<p><img src="hippocampus-edge-detection_files/figure-html/plotFiltering-1.png" class="r-plt" alt="" width="1152"></p>
</div>
<div class="section level3">
<h3 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h3>
<p>This vignette demonstrated the <strong>SpatialDryArtifacts</strong>
workflow across multiple spatial transcriptomics platforms.
Specifically, it showed:</p>
<ul>
<li>
<strong>Standard Visium workflow:</strong> Complete example using
the included hippocampus dataset</li>
<li>
<strong>VisiumHD adaptation:</strong> How to properly scale
parameters for 16µm and 8µm resolution data<br>
</li>
<li>
<strong>Platform-specific considerations:</strong> Grid arrangement,
parameter scaling formulas, and typical artifact sizes</li>
<li>
<strong>Visualization:</strong> Display hierarchical classification
results alongside QC metrics<br>
</li>
<li>
<strong>Classification logic:</strong> Distinguish between edge
vs. interior and large vs. small artifacts</li>
<li>
<strong>Validation:</strong> Flagged spots show significantly lower
molecular capture</li>
</ul>
<p><strong>Key Takeaways for Multi-Platform Usage:</strong></p>
<ol style="list-style-type: decimal">
<li><p><strong>Grid Structure:</strong> Standard Visium uses hexagonal
grids (<code>shifted = TRUE</code>), while VisiumHD uses square grids
(<code>shifted = FALSE</code>)</p></li>
<li>
<p><strong>Critical Parameter Scaling:</strong> The
<code>min_spots</code> threshold in <code><a href="../reference/classifyEdgeArtifacts.html">classifyEdgeArtifacts()</a></code>
must scale with spatial resolution:</p>
<ul>
<li>Use the formula:
<code>min_spots_HD = min_spots_visium × (55 / bin_size)²</code>
</li>
<li>Without scaling, artifacts will be incorrectly classified by
size</li>
</ul>
</li>
<li><p><strong>Morphological Framework:</strong> The same detection
logic works across platforms, automatically adapting to different grid
arrangements</p></li>
<li><p><strong>Physical Consistency:</strong> Scaled parameters ensure
that “large” and “small” artifact classifications represent equivalent
physical sizes regardless of platform</p></li>
</ol>
<p>Overall, <strong>SpatialDryArtifacts</strong> provides a unified,
platform-agnostic framework for detecting and classifying spatial
artifacts, enabling consistent quality control across the evolving
spatial transcriptomics technology landscape.</p>
</div>
<div class="section level3">
<h3 id="session-information">Session Information<a class="anchor" aria-label="anchor" href="#session-information"></a>
</h3>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; R Under development (unstable) (2026-02-09 r89390)</span></span>
<span><span class="co">#&gt; Platform: x86_64-conda-linux-gnu</span></span>
<span><span class="co">#&gt; Running under: Rocky Linux 9.4 (Blue Onyx)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Matrix products: default</span></span>
<span><span class="co">#&gt; BLAS:   /jhpce/shared/community/core/conda_R/devel/R/lib64/R/lib/libRblas.so </span></span>
<span><span class="co">#&gt; LAPACK: /jhpce/shared/community/core/conda_R/devel/R/lib64/R/lib/libRlapack.so;  LAPACK version 3.12.1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; locale:</span></span>
<span><span class="co">#&gt;  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              </span></span>
<span><span class="co">#&gt;  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    </span></span>
<span><span class="co">#&gt;  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8   </span></span>
<span><span class="co">#&gt;  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                 </span></span>
<span><span class="co">#&gt;  [9] LC_ADDRESS=C               LC_TELEPHONE=C            </span></span>
<span><span class="co">#&gt; [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; time zone: US/Eastern</span></span>
<span><span class="co">#&gt; tzcode source: system (glibc)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attached base packages:</span></span>
<span><span class="co">#&gt; [1] stats4    stats     graphics  grDevices utils     datasets  methods  </span></span>
<span><span class="co">#&gt; [8] base     </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; other attached packages:</span></span>
<span><span class="co">#&gt;  [1] dplyr_1.2.0                 patchwork_1.3.2            </span></span>
<span><span class="co">#&gt;  [3] ggplot2_4.0.1               SpatialDryArtifacts_0.99.0 </span></span>
<span><span class="co">#&gt;  [5] SpatialExperiment_1.21.0    SingleCellExperiment_1.33.0</span></span>
<span><span class="co">#&gt;  [7] SummarizedExperiment_1.41.1 Biobase_2.71.0             </span></span>
<span><span class="co">#&gt;  [9] GenomicRanges_1.63.1        Seqinfo_1.1.0              </span></span>
<span><span class="co">#&gt; [11] IRanges_2.45.0              S4Vectors_0.49.0           </span></span>
<span><span class="co">#&gt; [13] BiocGenerics_0.57.0         generics_0.1.4             </span></span>
<span><span class="co">#&gt; [15] MatrixGenerics_1.23.0       matrixStats_1.5.0          </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; loaded via a namespace (and not attached):</span></span>
<span><span class="co">#&gt;  [1] gtable_0.3.6        rjson_0.2.23        xfun_0.55          </span></span>
<span><span class="co">#&gt;  [4] bslib_0.10.0        htmlwidgets_1.6.4   lattice_0.22-9     </span></span>
<span><span class="co">#&gt;  [7] vctrs_0.7.1         tools_4.6.0         parallel_4.6.0     </span></span>
<span><span class="co">#&gt; [10] tibble_3.3.1        pkgconfig_2.0.3     Matrix_1.7-4       </span></span>
<span><span class="co">#&gt; [13] RColorBrewer_1.1-3  S7_0.2.1            desc_1.4.3         </span></span>
<span><span class="co">#&gt; [16] lifecycle_1.0.5     compiler_4.6.0      farver_2.1.2       </span></span>
<span><span class="co">#&gt; [19] textshaping_1.0.4   terra_1.8-86        codetools_0.2-20   </span></span>
<span><span class="co">#&gt; [22] htmltools_0.5.9     sass_0.4.10         yaml_2.3.12        </span></span>
<span><span class="co">#&gt; [25] pkgdown_2.2.0       pillar_1.11.1       jquerylib_0.1.4    </span></span>
<span><span class="co">#&gt; [28] BiocParallel_1.45.0 DelayedArray_0.37.0 cachem_1.1.0       </span></span>
<span><span class="co">#&gt; [31] magick_2.9.0        abind_1.4-8         tidyselect_1.2.1   </span></span>
<span><span class="co">#&gt; [34] digest_0.6.39       labeling_0.4.3      fastmap_1.2.0      </span></span>
<span><span class="co">#&gt; [37] grid_4.6.0          cli_3.6.5           SparseArray_1.11.10</span></span>
<span><span class="co">#&gt; [40] magrittr_2.0.4      S4Arrays_1.11.1     dichromat_2.0-0.1  </span></span>
<span><span class="co">#&gt; [43] withr_3.0.2         scales_1.4.0        rmarkdown_2.30     </span></span>
<span><span class="co">#&gt; [46] XVector_0.51.0      otel_0.2.0          ragg_1.5.0         </span></span>
<span><span class="co">#&gt; [49] beachmat_2.27.2     evaluate_1.0.5      knitr_1.51         </span></span>
<span><span class="co">#&gt; [52] viridisLite_0.4.3   rlang_1.1.7         Rcpp_1.1.1         </span></span>
<span><span class="co">#&gt; [55] glue_1.8.0          scuttle_1.21.0      jsonlite_2.0.0     </span></span>
<span><span class="co">#&gt; [58] R6_2.6.1            systemfonts_1.3.1   fs_1.6.6</span></span></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Jiali Harriet He, Stephanie Hicks, Michael Totty, Jacqueline Thompson.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

      </footer>
</div>






  </body>
</html>
